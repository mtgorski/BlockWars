@*
    For more information on enabling MVC for empty projects, visit http://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    Layout = @"~/Views/Shared/_Layout.cshtml";
}
<div id="gameContainer"></div>
<div id="gameOver" hidden="hidden"><p>Game Over! <button id="playAgainButton" type="button" class="btn btn-info xobutton">Play Again!</button></div>
<script src="/lib/jquery/js/jquery.js"></script>
<script src="/lib/signalr/jquery.signalr.js"></script>
<script src="/signalr/hubs"></script>
<script>

    $(function () {
        var gameHub = $.connection.game;
        var currentGame;

        function playAgain() {
            $("#gameOver").hide();
            $("#gameContainer").empty();
            currentGame = null;
        }
        $("#playAgainButton").click(playAgain);
        
        gameHub.client.updateRegionInfo = function (leagueInfo) {

            if (currentGame == null) {
                currentGame = leagueInfo.League.LeagueId;
            }
            if (currentGame != leagueInfo.League.LeagueId) {
                $("#gameOver").show();
                $("#gameContainer .build-button").prop('disabled', true).off('click');
                return;
            }

            
            $.each(leagueInfo.Regions, function () {
                if ($("#" + this.RegionId).length === 0) {
                    var $newElement = $('<div>', { 'id': this.RegionId });
                    var $name = $('<div>', { 'class': 'region-name', 'style': 'font-size:30px' }).text(this.Name + "     ");
                    var name = this.Name;
                    var $click = $('<button>', { 'class': 'build-button' }).text('+').click(function () {
                        gameHub.server.buildBlock(currentGame, name);
                    });
                    $name.append($click);
                    $newElement.append($name);
                    var $blockCount = $('<p>', { 'class': 'region-count', 'style': 'color:red;font-size:30px' }).text(this.BlockCount);
                    $newElement.append($blockCount);
                    $("#gameContainer").append($newElement);
                }
                var regionSelector = "#" + this.RegionId;
                $(regionSelector + " .region-count").text(this.BlockCount);
            });
        }

        $.connection.hub.start();
    });
</script>